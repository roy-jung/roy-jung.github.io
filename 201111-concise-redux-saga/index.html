<!DOCTYPE html><html lang="ko-KR"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>redux-saga를 간결하게 사용해보자! | FE재남</title><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/highlights/dracula.css"><link rel="canonical" href="http://roy-jung.github.io/201111-concise-redux-saga/"/>
<meta name="description" content="React.js에 redux 및 redux-saga를 얹어 사용하면서 느낀 피로감을 최소화하고자 노력한 결과가 제 나름으론 만족스럽게 나와 공유하고자 합니다. 패키지 구조redux-saga를 보다 쉽게 사용하고자 하는 데에 포커스를 맞춘 연습용…">
<meta property="og:type" content="article">
<meta property="og:title" content="redux-saga를 간결하게 사용해보자!">
<meta property="og:url" content="http://roy-jung.github.io/201111-concise-redux-saga/">
<meta property="og:site_name" content="FE재남">
<meta property="og:description" content="React.js에 redux 및 redux-saga를 얹어 사용하면서 느낀 피로감을 최소화하고자 노력한 결과가 제 나름으론 만족스럽게 나와 공유하고자 합니다. 패키지 구조redux-saga를 보다 쉽게 사용하고자 하는 데에 포커스를 맞춘 연습용…">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="http://roy-jung.github.io/images/post-cover4.jpg">
<meta property="article:published_time" content="2020-11-11T01:26:03.000Z">
<meta property="article:modified_time" content="2025-04-02T11:37:01.499Z">
<meta property="article:author" content="Jaenam Jung">
<meta property="article:tag" content="React.js">
<meta property="article:tag" content="redux-saga">
<meta property="article:tag" content="refactoring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://roy-jung.github.io/images/post-cover4.jpg"><meta property="article:author" content="Jaenam Jung"><meta property="twitter:label1" content="Published at"><meta property="twitter:data1" content="2020-11-11 10:26:03"><meta property="twitter:label2" content="Written by"><meta property="twitter:data2" content="Jaenam Jung"><link rel="icon" href="/images/logo.png"><link rel="alternate" href="/atom.xml" type="application/atom+xml" title="FE재남"><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="https://schema.org/WebPage"><nav class="menu" id="menu"><div class="menu-inner"><div class="menu__left-area"><div class="menu__item"><a class="menu__item__link menu__item__link--brand" href="/" title="Home" rel="home"><img class="menu__item__link--brand__image" src="/images/logo.png" alt="FE재남"><span class="menu__item__link--brand__label">FE재남</span></a></div></div><div class="menu__right-area"><div class="menu__item"><a class="menu__item__link" href="/">Home</a></div><div class="menu__item"><a class="menu__item__link" href="/about">About</a></div></div></div></nav><div class="page-background"></div><div class="content-container"><div class="content-outer"><div class="content-inner" itemscope itemtype="https://schema.org/Blog"><article class="article" id="article" itemscope itemtype="https://schema.org/BlogPosting"><h1 class="article__title" itemprop="headline">redux-saga를 간결하게 사용해보자!</h1><div class="article__meta"><time class="article__meta__time" datetime="2020-11-11T01:26:03.000Z" itemprop="datePublished">2020-11-11 10:26:03</time><div class="article__meta__categories"><a class="article__meta__categories__item" href="/categories/fe/">FE</a><span class="article__meta__categories__separator">></span><a class="article__meta__categories__item" href="/categories/fe/react-js/">React.js</a></div></div><div class="article__contents"><img src="/images/post-cover4.jpg"/><p>React.js에 redux 및 redux-saga를 얹어 사용하면서 느낀 피로감을 최소화하고자 노력한 결과가 제 나름으론 만족스럽게 나와 공유하고자 합니다.</p>
<h2 id="패키지-구조"><a href="#패키지-구조" class="headerlink" title="패키지 구조"></a>패키지 구조</h2><p>redux-saga를 보다 쉽게 사용하고자 하는 데에 포커스를 맞춘 연습용 프로젝트로, 디펜던시는 다음과 같습니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^17.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^17.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;redux&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;react-redux&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.2.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;redux-saga&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;immer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.14&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;axios&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.21.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-action"><a href="#1-action" class="headerlink" title="1. action"></a>1. action</h2><h3 id="1-비동기-상태관리에-대한-불만-요소"><a href="#1-비동기-상태관리에-대한-불만-요소" class="headerlink" title="1) 비동기 상태관리에 대한 불만 요소"></a>1) 비동기 상태관리에 대한 불만 요소</h3><p>리덕스를 사용하다 보면 액션명을 생성하는 데에 반복이 너무나 많아 불만이었습니다. 무엇보다 비동기처리를 위해서 동일한 액션명에 대해 ‘_REQUEST’, ‘_SUCCESS’, ‘_FAILURE’와 같이 요청과 응답성공, 응답실패의 세가지 케이스를 모두 만들어야 한다는 점이 가장 힘들었습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* actions.js */</span></span><br><span class="line"><span class="keyword">const</span> userActions = &#123;</span><br><span class="line">  <span class="attr">LOGIN_REQUEST</span>: <span class="string">&#x27;LOGIN_REQUEST&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGIN_SUCCESS</span>: <span class="string">&#x27;LOGIN_SUCCESS&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGIN_FAILURE</span>: <span class="string">&#x27;LOGIN_FAILURE&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGOUT_REQUEST</span>: <span class="string">&#x27;LOGOUT_REQUEST&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGOUT_SUCCESS</span>: <span class="string">&#x27;LOGOUT_SUCCESS&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGOUT_FAILURE</span>: <span class="string">&#x27;LOGOUT_FAILURE&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/user.js */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">userReducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGIN_REQUEST</span>: ...</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGIN_SUCCESS</span>: ...</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGIN_FAILURE</span>: ...</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGOUT_REQUEST</span>: ...</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGOUT_SUCCESS</span>: ...</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGOUT_FAILURE</span>: ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-status-프로퍼티로-관리"><a href="#2-status-프로퍼티로-관리" class="headerlink" title="2) status 프로퍼티로 관리"></a>2) status 프로퍼티로 관리</h3><p>이에 가장 먼저 생각한 방법은 action은 하나만 둔 상태에서 ‘status’ 프로퍼티로 비동기 처리의 상태를 관리하는 것이었습니다. 그랬더니 이번에는 reducer가 골치입니다. 최상단에서는 간결해졌지만 그래봤자 내부에서는 다시 switch case를 태워야 하나? 좀 아닌 것 같지만, 해보고 나서 생각하자 싶어 일단은 진행합니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* actions.js */</span></span><br><span class="line"><span class="keyword">const</span> userActions = &#123;</span><br><span class="line">  <span class="attr">LOGIN</span>: <span class="string">&#x27;LOGIN&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGOUT</span>: <span class="string">&#x27;LOGOUT&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/user.js */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">userReducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGIN</span>: &#123;</span><br><span class="line">      <span class="keyword">switch</span> (action.<span class="property">data</span>.<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">REQUEST</span>: ...</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">SUCCESS</span>: ...</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">FAILURE</span>: ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGOUT</span>: &#123;</span><br><span class="line">      <span class="keyword">switch</span> (action.<span class="property">data</span>.<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">REQUEST</span>: ...</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">SUCCESS</span>: ...</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">FAILURE</span>: ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>역시나 이건 아니다 싶네요. 반복되는 REQUEST, SUCCESS, FAILURE에 대한 처리를 보다 효율적으로 할 수 있는 방안이 필요해 보입니다. 고민 끝에 적절한 방안을 찾아내긴 했습니다만 이에 대해서는 reducer 파트에서 자세히 소개하기로 하고, 지금은 일단 action 파트에 집중하겠습니다. 어쩄든 action명의 뒷부분을 과감히 덜어내고 reducer 쪽의 고민도 해결하고 보니, 이번엔 또 전혀 새로운 단점이 눈에 들어왔습니다. redux를 사용할 때 얻는 가장 큰 이점 중 하나는 뭐니뭐니 해도 redux-devtool일텐데요,</p>
<img src="./1.png" width="360" alt="디버깅이 망했어요!" />

<p>action명만 보고는 이게 어떤 동작인지를 유추조차 할 수가 없습니다. 일일이 액션 하나하나를 열어보아야만이 요청인지 성공인지 실패인지를 알 수 있어 몹시 불편합니다. 역시나 아니다 싶네요. 단순반복을 ‘아주 약간’ 피하는 대신 디버깅에서는 치명적인 단점으로 보이기까지 합니다. </p>
<h3 id="3-suffix-자동-부여"><a href="#3-suffix-자동-부여" class="headerlink" title="3) suffix 자동 부여"></a>3) suffix 자동 부여</h3><p>‘결국은 하나의 동작에 대해 여러개의 액션을 만드는 수밖에 없나’ 하며 풀 죽어 있다가, (<a target="_blank" rel="noopener" href="https://pburtchaell.gitbook.io/redux-promise-middleware/guides/custom-suffixes">redux-promise-middleware</a>)에서 힌트를 얻었습니다. 생각해보면 사용자 입장에서 직접 action을 dispatch해야 하는 경우는 오직 ‘REQUEST’할 때 뿐이고, 나머지는 서버의 응답에 따라 <strong>자동으로</strong> 동작하게끔 처리해줘야 하는 것들입니다. 이를 위해서 redux-saga를 사용하는 것이니, 이들에 대해서까지 action 명을 굳이 직접 만들어야 할 이유가 없는 셈이기도 하죠! 자동으로 동작할 액션들은 자동으로 부여하도록 해주면 될 일이었습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* actions.js */</span></span><br><span class="line"><span class="keyword">const</span> userActions = &#123;</span><br><span class="line">  <span class="attr">LOGIN</span>: <span class="string">&#x27;LOGIN&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGOUT</span>: <span class="string">&#x27;LOGOUT&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/user.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; all, put, takeLatest &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/login&#x27;</span>, action.<span class="property">data</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`LOGIN__success`</span>,</span><br><span class="line">      <span class="attr">data</span>: result.<span class="property">data</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`LOGIN__failure`</span>,</span><br><span class="line">      <span class="attr">data</span>: result.<span class="property">data</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> userSaga*() &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">all</span>([ <span class="title function_">takeLatest</span>(userActions.<span class="property">LOGIN</span>, login) ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/user.js */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">userReducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGIN</span>: ...</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGIN__success</span>: ...</span><br><span class="line">    <span class="keyword">case</span> userActions.<span class="property">LOGIN__failure</span>: ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>대충 이런 식으로 하면 처음보다는 그래도 숨통이 트이는 느낌이네요. reducer는 변화가 없긴 하지만, 이 부분은 따로 처리하면 될 일이니까요. 나아가 굳이 action은 별도의 ‘action’ 폴더에 두지 않고 root로 옮겨 actions.js 파일 하나로 관리하도록 하였습니다. store 프로퍼티명에 대응하는 actions 변수 안에 각 액션명들로 구성된 배열들을 만들고, 이들을 한 데 모아 <code>&#123; LOGIN: &#39;LOGIN&#39;, ...&#125;</code>와 같이 하나의 객체로 export 하도록 처리하였습니다. 규모가 커져서 액션이 많을 수밖에 없다면 action 폴더를 만드는 편이 낫겠지만, 지금으로선 이정도로 충분해 보입니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* actions.js */</span></span><br><span class="line"><span class="keyword">const</span> userActions = [</span><br><span class="line">  <span class="string">&#x27;LOGIN&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;LOGOUT&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> postActions = [</span><br><span class="line">  <span class="string">&#x27;ADD_POST&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;REMOVE_POST&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">]</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  ...userActions,</span><br><span class="line">  ...postActions</span><br><span class="line">].<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, c</span>) =&gt;</span> &#123;</span><br><span class="line">  a[c] = c</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="2-saga"><a href="#2-saga" class="headerlink" title="2. saga"></a>2. saga</h2><h3 id="1-saga-파일에-대한-불만-요소"><a href="#1-saga-파일에-대한-불만-요소" class="headerlink" title="1) saga 파일에 대한 불만 요소"></a>1) saga 파일에 대한 불만 요소</h3><p>saga 파트에서 가장 불만스러운 부분은, try catch로 감싸는 처리가 매번 반복된다는 점입니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/user.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; all, put, takeLatest &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/login&#x27;</span>, action.<span class="property">data</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;Actions.LOGIN&#125;</span>__success`</span>,</span><br><span class="line">      <span class="attr">data</span>: result.<span class="property">data</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;Actions.LOGIN&#125;</span>__failure`</span>,</span><br><span class="line">      <span class="attr">data</span>: err.<span class="property">response</span>.<span class="property">data</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> logout = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/logout&#x27;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;Actions.LOGOUT&#125;</span>__success`</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;Actions.LOGOUT&#125;</span>__failure`</span>,</span><br><span class="line">      <span class="attr">data</span>: err.<span class="property">response</span>.<span class="property">data</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> userSaga*() &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">takeLatest</span>(<span class="title class_">Actions</span>.<span class="property">LOGIN</span>, login),</span><br><span class="line">    <span class="title function_">takeLatest</span>(<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>, logout),</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-taker-함수로-공통요소-처리"><a href="#2-taker-함수로-공통요소-처리" class="headerlink" title="2) taker 함수로 공통요소 처리"></a>2) taker 함수로 공통요소 처리</h3><p>가만 보니 ‘LOGIN’에 대한 대응 액션은 ‘LOGIN__success’, ‘LOGIN__failure’이고, try catch는 모든 경우에 공통으로 이루어집니다. 그렇다면 함수로 좀 더 편리하게 처리할 수 있을 것 같습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/taker.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; put &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">taker</span> = (<span class="params">actionType, func</span>) =&gt; <span class="keyword">function</span>* (action) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> <span class="title function_">func</span>(action)</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;actionType&#125;</span>__success`</span>,</span><br><span class="line">      <span class="attr">data</span>: result.<span class="property">data</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;actionType&#125;</span>__failure`</span>,</span><br><span class="line">      <span class="attr">data</span>: err.<span class="property">response</span>.<span class="property">data</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> taker</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/user.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; all, takeLatest &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> taker <span class="keyword">from</span> <span class="string">&#x27;./taker&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/login&#x27;</span>, action.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> logout = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/logout&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> userSaga*() &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">takeLatest</span>(<span class="title class_">Actions</span>.<span class="property">LOGIN</span>, <span class="title function_">taker</span>(<span class="title class_">Actions</span>.<span class="property">LOGIN</span>, login)),</span><br><span class="line">    <span class="title function_">takeLatest</span>(<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>, <span class="title function_">taker</span>(<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>, logout)),</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이것만으로 이미 만족도가 꽤 높아졌습니다. 제너레이터 함수들은 오직 비동기 요청만을 수행하고, 나머지는 모두 taker가 도맡아 처리합니다. 다만 마지막의 userSaga 부분에서 같은 액션이 두 번씩 등장하고, taker를 호출하는 내용이 계속 반복되니 이 것도 줄여볼 수 있을 것 같습니다. 주로 takeLatest가 많이 쓰이므로 디폴트로 설정하고, 그밖의 메소드를 지정할 수 있게 하면서 나아가 throttle 등을 사용하는 경우를 위한 option까지 받도록 해보겠습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/taker.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeLatest, put &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">taker</span> = (<span class="params">actionType, func, takeMethod = takeLatest, takeOption</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> params = [</span><br><span class="line">    actionType,</span><br><span class="line">    <span class="keyword">function</span>* (action) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">yield</span> <span class="title function_">func</span>(action)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 결과가 없는 경우에도 failure 처리</span></span><br><span class="line">        <span class="keyword">if</span> (!result || !result.<span class="property">data</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;no data&#x27;</span>, actionType)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;actionType&#125;</span>__success`</span>,</span><br><span class="line">          <span class="attr">data</span>: result.<span class="property">data</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;actionType&#125;</span>__failure`</span>,</span><br><span class="line">          <span class="attr">error</span>: err.<span class="property">response</span>.<span class="property">data</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">  <span class="comment">// throttle 등의 옵션값은 맨 앞으로.</span></span><br><span class="line">  <span class="keyword">if</span> (takeOption) params.<span class="title function_">unshift</span>(takeOption)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">method</span>(...params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> taker</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/user.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; throttle &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"><span class="keyword">import</span> taker <span class="keyword">from</span> <span class="string">&#x27;./taker&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 중략</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkConnection = <span class="keyword">function</span>*() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/connection&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> userSaga*() &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">taker</span>(<span class="title class_">Actions</span>.<span class="property">LOGIN</span>, login),</span><br><span class="line">    <span class="title function_">taker</span>(<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>, logout),</span><br><span class="line">    <span class="title function_">taker</span>(<span class="title class_">Actions</span>.<span class="property">CONNECTED</span>, checkConnection, throttle, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>),</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/index.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"><span class="keyword">import</span> postSaga <span class="keyword">from</span> <span class="string">&#x27;./post&#x27;</span></span><br><span class="line"><span class="keyword">import</span> userSaga <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* <span class="title function_">rootSaga</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">all</span>([postSaga, userSaga])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-보다-더-간결하게"><a href="#3-보다-더-간결하게" class="headerlink" title="3) 보다 더 간결하게!"></a>3) 보다 더 간결하게!</h3><p>상당히 간결해 졌습니다. 그런데 기왕 하는 김에 각각의 saga 파일들에서 공통으로 처리하는 마지막 요소를 조금 더 다듬을 수 있을 것 같습니다. 반복되는 내용들은 모조리 saga/index.js에서 처리하도록 하고, 개별 saga 파일들에서는 작업량을 최소화 하도록 해보죠.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/user.js */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/login&#x27;</span>, action.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> logout = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/logout&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> checkConnection = <span class="keyword">function</span>*() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/connection&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN</span>, login],</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>, logout],</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">CONNECTED</span>, checkConnection, throttle, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* saga/index.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"><span class="keyword">import</span> postSaga <span class="keyword">from</span> <span class="string">&#x27;./post&#x27;</span></span><br><span class="line"><span class="keyword">import</span> userSaga <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">taker</span> = (<span class="params">...</span>) =&gt; &#123; ... &#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">takesAll</span> = sagaItems =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">all</span>(sagaItems.<span class="title function_">map</span>(<span class="function"><span class="params">saga</span> =&gt;</span> <span class="title function_">taker</span>(...saga)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* <span class="title function_">rootSaga</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">takesAll</span>(postSaga),</span><br><span class="line">    <span class="title function_">takesAll</span>(userSaga),</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 saga 폴더 각 파일 내에서는 비동기 ‘요청’에 대한 것만 신경쓰면 됩니다. 각 파일의 마지막에 watch할 내용들을 배열로 묶어서 saga/index.js로 전달하기만 하면 됩니다. index에서는 받은 배열들을 바탕으로 이쁘게 말아서 rootSaga로 통합합니다.</p>
<h2 id="3-reducer"><a href="#3-reducer" class="headerlink" title="3. reducer"></a>3. reducer</h2><h3 id="1-비동기-상태-관리에-대한-시행착오"><a href="#1-비동기-상태-관리에-대한-시행착오" class="headerlink" title="1) 비동기 상태 관리에 대한 시행착오"></a>1) 비동기 상태 관리에 대한 시행착오</h3><p>reducer는 사람마다 각양 각색으로 관리하는 것 같지만, 프론트엔드 개발자의 입장에서는 상태변화를 감지하여 뷰에 노출할지 여부를 판단하는 것이 생각보다 많이 중요하다보니, 비동기 처리시마다 해당 정보를 reducer에 남기는 방법을 고민해 왔습니다. 그 중 제가 아는 한에서 대중적으로 많이 쓰이는 방식은 다음과 같았습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/user.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">&#x27;immer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">loginLoading</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">loginDone</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">loginError</span>: <span class="literal">false</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userReducer = <span class="title function_">produce</span>(<span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN</span>:</span><br><span class="line">      draft.<span class="property">loginLoading</span> = <span class="literal">true</span></span><br><span class="line">      draft.<span class="property">loginDone</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginError</span> = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__success</span>: &#123;</span><br><span class="line">      <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">      draft.<span class="property">loggedId</span> = loggedId</span><br><span class="line">      draft[loggedId] = action.<span class="property">data</span></span><br><span class="line">      draft.<span class="property">loginLoading</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginDone</span> = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__failure</span>:</span><br><span class="line">      draft.<span class="property">loginLoading</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginDone</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginError</span> = action.<span class="property">error</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>하나의 액션에 대해 오직 뷰에서의 처리를 위해 3개씩의 상태를 들고 있어야 한다는 점이 매우 몹시 마음에 들지 않습니다. 그래서 예전부터 다양한 방법을 시도해 보았는데, 결국에는 다시 여기로 돌아오게 되더군요. 다음 코드는 제가 몇 년 전에 시도했다가 크게 실패헀던 방안입니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">LOADING</span> = <span class="string">&#x27;LOADING&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DONE</span> = <span class="string">&#x27;DONE&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ERROR</span> = <span class="string">&#x27;ERROR&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">actionTarget</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">actionStatus</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">loggedId</span>: <span class="literal">null</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userReducer = <span class="title function_">produce</span>(<span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;login&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__success</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;login&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__failure</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;login&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = action.<span class="property">error</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGOUT</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;logout&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGOUT__success</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;logout&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGOUT__failure</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;logout&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = action.<span class="property">error</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;nicknameChange&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE__success</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;nicknameChange&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE__failure</span>:</span><br><span class="line">      draft.<span class="property">actionTarget</span> = <span class="string">&#x27;nicknameChange&#x27;</span></span><br><span class="line">      draft.<span class="property">actionStatus</span> = action.<span class="property">error</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이 방법은 그때 당시의 제 생각에는 효율적이어서 좋을 줄 알았지만, 실은 사용자가 화면에서 여러가지 동작을 하다 보면 금방 꼬여버리기 십상이더군요.</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">actionTarget</th>
<th align="left">result</th>
<th align="left">actionStatus</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1 REQUEST</td>
<td align="left">‘login’</td>
<td align="left"></td>
<td align="left">LOADING</td>
</tr>
<tr>
<td align="left">2 RESPONSE</td>
<td align="left">‘login’</td>
<td align="left">SUCCESS</td>
<td align="left">DONE</td>
</tr>
<tr>
<td align="left">3 REQUEST</td>
<td align="left">‘nicknameChange’</td>
<td align="left"></td>
<td align="left">LOADING</td>
</tr>
<tr>
<td align="left">4 REQUEST</td>
<td align="left">‘logout’</td>
<td align="left"></td>
<td align="left">LOADING</td>
</tr>
<tr>
<td align="left">5 RESPONSE</td>
<td align="left">‘nicknameChange’</td>
<td align="left">FAILURE</td>
<td align="left">ERROR</td>
</tr>
<tr>
<td align="left">6 RESPONSE</td>
<td align="left">‘logout’</td>
<td align="left">SUCCESS</td>
<td align="left">DONE</td>
</tr>
</tbody></table>
<p>3번과 4번 요청에 대하여 서버에서 어떤 이유에서인지 4번을 먼저 처리한 경우, 그럼에도 응답은 순서대로 도착한 경우의 시나리오입니다. 근소한 차이로 도달한 5번 6번에 의해 화면상에는 ‘닉네임 변경 실패’를 노출할 타이밍을 놓쳐버리거나, 혹은 5번에 대한 처리는 정상적으로 이루어졌음에도 불구하고 6번에 대한 정책인 화면 전환(Router.replace)으로 인해 노티를 육안으로 확인하지 못하는 경우가 발생합니다. 이런 경우 Redux devtool의 히스토리를 뒤져보면 현상은 파악할 수 있긴 하지만, devtool을 비활성화 시킨 배포환경에서는 유추하기가 쉽지 않습니다.</p>
<p>다른 문제도 있습니다. actionTarget, asyncStatus라는 두 상태의 변화를 구독해야 하는 컴포넌트가 계속해서 늘어난다는 점입니다. 각 컴포넌트에서 useEffect를 이용하여 두 상태를 감시하고 asyncTarget이 목적하는 문자열과 일치하는 경우에 대해 부가적인 작업을 수행할텐데, 이 두 값은 사용자의 사소한 동작들 하나하나에 수시로 변경될 것입니다. 성능상에 부정적인 영향을 줄 가능성을 배제할 수 없겠습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Component1</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (actionTarget === <span class="string">&#x27;login&#x27;</span>) ...</span><br><span class="line">  &#125;, [actionTarget, actionStatus])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Component2</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (actionTarget === <span class="string">&#x27;nicknameChange&#x27;</span>) ...</span><br><span class="line">  &#125;, [actionTarget, actionStatus])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Component3</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (actionTarget === <span class="string">&#x27;logout&#x27;</span>) ...</span><br><span class="line">  &#125;, [actionTarget, actionStatus])</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>반면 redux store가 비대해지는 자체로는 컴포넌트의 성능에 큰 영향을 줄 소지가 없습니다. 아무리 거대한 객체구조가 이루어져 있더라도 컴포넌트에 해당 값이 전달되지 않는 이상은 렌더링에 부하를 줄 일 자체가 없습니다. 그러니까 관건은 store의 각 상태값들이 특정 컴포넌트에서 <strong>실제로 필요한 경우에만</strong> 변경이 이뤄지도록 하는 것입니다. </p>
<h3 id="2-상태값-줄이기"><a href="#2-상태값-줄이기" class="headerlink" title="2) 상태값 줄이기"></a>2) 상태값 줄이기</h3><p>다시 원래의 코드로 돌아옵시다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">loginLoading</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">loginDone</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">loginError</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userReducer = <span class="title function_">produce</span>(<span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN</span>:</span><br><span class="line">      draft.<span class="property">loginLoading</span> = <span class="literal">true</span></span><br><span class="line">      draft.<span class="property">loginDone</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginError</span> = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__success</span>:</span><br><span class="line">      draft.<span class="property">loginLoading</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginDone</span> = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__failure</span>:</span><br><span class="line">      draft.<span class="property">loginLoading</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginDone</span> = <span class="literal">false</span></span><br><span class="line">      draft.<span class="property">loginError</span> = action.<span class="property">error</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>가만 보니까 ‘login’과 관련한 동작은 무조건 <code>LOADING / DONE / ERROR</code>의 셋 중 하나로 귀결됩니다. 어떤 하나의 상태가 truthy하면 나머지 둘은 무조건 falsy합니다. <em><code>null</code>은 사용자가 login 관련 동작을 한 번이라도 수행하면 영원히 볼 수 없는 값이므로 무의미한 것 같습니다.</em></p>
<table>
<thead>
<tr>
<th align="center">action</th>
<th align="center">loading</th>
<th align="center">done</th>
<th align="center">error</th>
</tr>
</thead>
<tbody><tr>
<td align="center">LOGIN REQUEST</td>
<td align="center">true</td>
<td align="center">false</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">LOGIN SUCCESS</td>
<td align="center">false</td>
<td align="center">true</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">LOGIN FAILURE</td>
<td align="center">false</td>
<td align="center">false</td>
<td align="center">errorMsg(truthy)</td>
</tr>
</tbody></table>
<p>그렇다면 다음과 같이 상태를 하나로 압축해도 되겠네요.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">loginStatus</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userReducer = <span class="title function_">produce</span>(<span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN</span>:</span><br><span class="line">      draft.<span class="property">loginStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__success</span>:</span><br><span class="line">      draft.<span class="property">loginStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Actions</span>.<span class="property">LOGIN__failure</span>:</span><br><span class="line">      draft.<span class="property">loginStatus</span> = action.<span class="property">error</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Component</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!loginStatus) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">switch</span> (loginStatus) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="attr">DONE</span>: <span class="keyword">return</span> <span class="title function_">setDone</span>()</span><br><span class="line">      <span class="keyword">case</span> <span class="attr">LOADING</span>: <span class="keyword">return</span> <span class="title function_">setLoading</span>()</span><br><span class="line">      <span class="attr">default</span>: <span class="keyword">return</span> <span class="title function_">setError</span>(loginStatus)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [loginStatus])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LOADING과 DONE은 상수를 활용하고, ERROR의 경우에는 에러메시지 자체를 상태값에 저장합니다. 이제는 store가 ‘그렇게까지’ 비대해지지는 않으면서도 로그인 상태를 잘 유지할 수 있겠습니다. 하나의 액션에 대해 하나의 상태값만을 지니므로 견딜만 한 수준이네요.</p>
<h3 id="3-공통요소와-추가요소-분리"><a href="#3-공통요소와-추가요소-분리" class="headerlink" title="3) 공통요소와 추가요소 분리"></a>3) 공통요소와 추가요소 분리</h3><p>그렇지만 여전히 불만은 있습니다. 리덕스를 쓰면 어디서나 반복이 많지만, 리듀서는 특히나 심합니다. 위와 같은 상태 관리를 매 액션별로 하나하나 전부 ‘똑같이’ 처리해줘야 하는데, 이걸 어떻게든 하고 싶네요. 우선 리듀서 전체를 아우르는 switch case를 객체 형태로 바꿔보면 방법이 보일지도 모르겠습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">loginStatus</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">logoutStatus</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">nicknameStatus</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">loggedId</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userReducerMap = &#123;</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">loginStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN__success</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">    draft.<span class="property">loggedId</span> = loggedId</span><br><span class="line">    draft[loggedId] = action.<span class="property">data</span></span><br><span class="line">    draft.<span class="property">loginStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN__failure</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">loginStatus</span> = action.<span class="property">error</span></span><br><span class="line">    draft.<span class="property">loggedId</span> = <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">logoutStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGOUT__success</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">logoutStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGOUT__failure</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">logoutStatus</span> = action.<span class="property">error</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">nicknameStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE__success</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">if</span> (loggedId &amp;&amp; draft[loggedId]) &#123;</span><br><span class="line">      draft[loggedId].<span class="property">nickname</span> = action.<span class="property">data</span>.<span class="property">nickname</span></span><br><span class="line">    &#125;</span><br><span class="line">    draft.<span class="property">nicknameStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE__failure</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">nicknameStatus</span> = action.<span class="property">error</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userReducer = <span class="title function_">produce</span>(<span class="function">(<span class="params">draft = initialState, action</span>) =&gt;</span></span><br><span class="line">  userReducerMap[action.<span class="property">type</span>] </span><br><span class="line">    ? userReducerMap[action.<span class="property">type</span>](draft, action)</span><br><span class="line">    : state</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>모든 액션에 대해 다음이 공통됩니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  [<span class="variable constant_">SOME_ACTION</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">someStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [SOME_ACTION__success]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">someStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [SOME_ACTION__failure]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">someStatus</span> = action.<span class="property">error</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>공통요소를 제외하면 다음만 남습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userReducerMap = &#123;</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN__success</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">    draft.<span class="property">loggedId</span> = loggedId</span><br><span class="line">    draft[loggedId] = action.<span class="property">data</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN__failure</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">loggedId</span> = <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE__success</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">if</span> (loggedId &amp;&amp; draft[loggedId]) &#123;</span><br><span class="line">      draft[loggedId].<span class="property">nickname</span> = action.<span class="property">data</span>.<span class="property">nickname</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-구조-변경-함수화"><a href="#4-구조-변경-함수화" class="headerlink" title="4) 구조 변경, 함수화"></a>4) 구조 변경, 함수화</h3><p>경우에 따라 어떤 액션은 success시에만, 어떤 액션은 failure에도 추가 처리가 필요합니다. 그렇다면 공통요소는 별도로 처리하기로 하고, 추가 처리가 필요한 부분에 대해서는 다음과 같은 구조로 바꾸면 좀 더 간결하게 만들 수 있을 것 같습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonReducerMap = &#123;</span><br><span class="line">  <span class="attr">request</span>: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">actionStatus</span> = <span class="variable constant_">LOADING</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">actionStatus</span> = <span class="variable constant_">DONE</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">failure</span>: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">actionStatus</span> = action.<span class="property">error</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userReducerMap = &#123;</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN</span>]: &#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">      draft.<span class="property">loggedId</span> = loggedId</span><br><span class="line">      draft[loggedId] = action.<span class="property">data</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">failure</span>: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">loggedId</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>]: &#123;&#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE</span>]: &#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">      <span class="keyword">if</span> (loggedId &amp;&amp; draft[loggedId]) &#123;</span><br><span class="line">        draft[loggedId].<span class="property">nickname</span> = action.<span class="property">data</span>.<span class="property">nickname</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>구상은 이런 겁니다. 액션명이 기본적으로 ‘ACTION’ / ‘ACTION__success’ / ‘ACTION__failure’ 세가지로 이루어져 있으니, 이걸 하나로 뭉쳐서 처리하는 겁니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reduceFunc</span> = (<span class="params">draft = initialState, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [actionType, status = <span class="string">&#x27;request&#x27;</span>] = action.<span class="property">type</span>.<span class="title function_">split</span>(<span class="string">&#x27;__&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> source = reducerMap[actionType]</span><br><span class="line">  source[status] &amp;&amp; source[status](draft, action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이렇게 바꾸고 보니 공통요소인 ‘someStatus’는 앞서 추출한 actionType을 활용하는 방식으로 바꾸면 간단하게 처리할 수 있겠네요. actionStatus 라는 객체 안에 각각의 actionType의 상태를 할당하는 방식으로 구현해 봅니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/user.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">&#x27;immer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">REQUEST</span> = <span class="string">&#x27;request&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SUCCESS</span> = <span class="string">&#x27;success&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FAILURE</span> = <span class="string">&#x27;failure&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">actionStatus</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">loggedId</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userReducerMap = &#123;</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN</span>]: &#123;</span><br><span class="line">    [<span class="variable constant_">SUCCESS</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">      draft.<span class="property">loggedId</span> = loggedId</span><br><span class="line">      draft[loggedId] = action.<span class="property">data</span></span><br><span class="line">    &#125;,</span><br><span class="line">    [<span class="variable constant_">FAILURE</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">loggedId</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGOUT</span>]: &#123;&#125;, <span class="comment">// 추가 처리요소가 없는 경우 빈 객체로.</span></span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">NICKNAME_CHANGE</span>]: &#123;</span><br><span class="line">    [<span class="variable constant_">SUCCESS</span>]: <span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> loggedId = action.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">      <span class="keyword">if</span> (loggedId &amp;&amp; draft[loggedId]) &#123;</span><br><span class="line">        draft[loggedId].<span class="property">nickname</span> = action.<span class="property">data</span>.<span class="property">nickname</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reduceFunc</span> = (<span class="params">draft = initialState, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; error, type &#125; = action</span><br><span class="line">  <span class="keyword">const</span> [actionType, status = <span class="variable constant_">REQUEST</span>] = type.<span class="title function_">split</span>(<span class="string">&#x27;__&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> source = userReducerMap[actionType]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 존재하지 않는 액션 처리</span></span><br><span class="line">  <span class="keyword">if</span> (!source) <span class="keyword">return</span> draft</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 공통요소(status) 처리</span></span><br><span class="line">  draft.<span class="property">actionStatus</span>[actionType] = status === <span class="variable constant_">FAILURE</span> ? error : status</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 추가요소 처리</span></span><br><span class="line">  source[status] &amp;&amp; source[status](draft, action)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userReducer = <span class="title function_">produce</span>(reduceFunc);</span><br></pre></td></tr></table></figure>

<p>reducerFunc를 고차함수로 변환하여 userReducerMap 및 initialState의 종속성을 제거해 봅시다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/reduceFunc.js */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reduceFunc</span> = (<span class="params">reducerMap, initialState</span>) =&gt; </span><br><span class="line">  <span class="function">(<span class="params">draft = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; error, type &#125; = action</span><br><span class="line">    <span class="keyword">const</span> [actionType, status = <span class="variable constant_">REQUEST</span>] = type.<span class="title function_">split</span>(<span class="string">&#x27;__&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> source = reducerMap[actionType]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!source) <span class="keyword">return</span> draft</span><br><span class="line">    draft.<span class="property">actionStatus</span>[actionType] = status === <span class="variable constant_">FAILURE</span> ? error : status</span><br><span class="line">    source[status] &amp;&amp; source[status](draft, action)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reduceFunc</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/user.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">&#x27;immer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reduceFunc <span class="keyword">from</span> <span class="string">&#x27;./reduceFunc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; ... &#125;</span><br><span class="line"><span class="keyword">const</span> userReducerMap = &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userReducer = <span class="title function_">produce</span>(<span class="title function_">reduceFunc</span>(userReducerMap, initialState));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userReducer</span><br></pre></td></tr></table></figure>

<h3 id="5-동기-액션에-대한-처리-보완"><a href="#5-동기-액션에-대한-처리-보완" class="headerlink" title="5) 동기 액션에 대한 처리 보완"></a>5) 동기 액션에 대한 처리 보완</h3><p>이제 REQUEST, SUCCESS, FAILURE로 구성된 비동기 액션들에 대한 처리는 완벽해 보입니다. 그러나 이대로는 일회성에 그치는 동기 액션은 제대로 처리하지 못합니다. 이 부분을 보완해 보겠습니다. 동기 액션은 하나만 존재하므로 객체가 아닌 ‘함수’일 것입니다. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/reduceFunc.js */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reduceFunc</span> = (<span class="params">reducerMap, initialState</span>) =&gt; </span><br><span class="line">  <span class="function">(<span class="params">draft = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; error, type &#125; = action</span><br><span class="line">    <span class="keyword">const</span> [actionType, status = <span class="variable constant_">REQUEST</span>] = type.<span class="title function_">split</span>(<span class="string">&#x27;__&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> source = reducerMap[actionType]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 존재하지 않는 액션 처리</span></span><br><span class="line">    <span class="keyword">if</span> (!source) <span class="keyword">return</span> draft</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 동기 처리</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> <span class="title function_">source</span>(draft, action)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 비동기 처리</span></span><br><span class="line">    draft.<span class="property">actionStatus</span>[actionType] = status === <span class="variable constant_">FAILURE</span> ? error : status</span><br><span class="line">    source[status] &amp;&amp; source[status](draft, action)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/post.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">&#x27;immer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reduceFunc <span class="keyword">from</span> <span class="string">&#x27;./reduceFunc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">images</span>: [],</span><br><span class="line">  <span class="attr">list</span>: [],</span><br><span class="line">  <span class="attr">actionStatus</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postReducerMap = &#123;</span><br><span class="line">  <span class="comment">// 동기 액션: 함수로 구성</span></span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">REMOVE_IMAGE</span>]: <span class="function">(<span class="params">draft, &#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">images</span> = draft.<span class="property">images</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> i !== data)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 비동기 액션: 객체로 구성</span></span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOAD_POSTS</span>]: &#123;</span><br><span class="line">    [<span class="variable constant_">SUCCESS</span>]: <span class="function">(<span class="params">draft, &#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">list</span> = data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">ADD_POST</span>]: &#123;</span><br><span class="line">    [<span class="variable constant_">SUCCESS</span>]: <span class="function">(<span class="params">draft, &#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">list</span>.<span class="title function_">unshift</span>(data)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postReducer = <span class="title function_">produce</span>(<span class="title function_">reduceFunc</span>(postReducerMap, initialState))</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> postReducer</span><br></pre></td></tr></table></figure>

<h3 id="6-보다-더-간결하게"><a href="#6-보다-더-간결하게" class="headerlink" title="6) 보다 더 간결하게!"></a>6) 보다 더 간결하게!</h3><p>각 reducer 파일에서 매 번 produce, reduceFunc를 import에서 쓰기보다는, 각 파일에서는 initialState와 reducerMap을 export하고, 이들을 combine하는 <code>reducer/index.js</code>에서 한 번에 처리하는 편이 더 나을 것 같네요. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/user.js */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">loggedId</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">actionStatus</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN</span>]: &#123;</span><br><span class="line">    [<span class="variable constant_">SUCCESS</span>]: <span class="function">(<span class="params">draft, &#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">loggedId</span> = data.<span class="property">id</span></span><br><span class="line">      draft[data.<span class="property">id</span>] = data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/post.js */</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">images</span>: [],</span><br><span class="line">  <span class="attr">list</span>: [],</span><br><span class="line">  <span class="attr">actionStatus</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postReducerMap = &#123;</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">REMOVE_IMAGE</span>]: <span class="function">(<span class="params">draft, &#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">images</span> = draft.<span class="property">images</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> i !== data)</span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOAD_POSTS</span>]: &#123;</span><br><span class="line">    [<span class="variable constant_">SUCCESS</span>]: <span class="function">(<span class="params">draft, &#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">list</span> = data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>기왕 reduceFunc를 index.js로 옮기는 김에 produce도 함수 내부에서 호출하면 더 간결할 것 같습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reducer/index.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">&#x27;immer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> userReducerMap, &#123; initialState <span class="keyword">as</span> userInitialState &#125; <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> postReducerMap, &#123; initialState <span class="keyword">as</span> postInitialState &#125; <span class="keyword">from</span> <span class="string">&#x27;./post&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reduceFunc</span> = (<span class="params">reducerMap, initialState</span>) =&gt; </span><br><span class="line">  <span class="title function_">produce</span>(<span class="function">(<span class="params">draft = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; error, type &#125; = action</span><br><span class="line">    <span class="keyword">const</span> [actionType, status = <span class="variable constant_">REQUEST</span>] = type.<span class="title function_">split</span>(<span class="string">&#x27;__&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> source = reducerMap[actionType]</span><br><span class="line">    <span class="keyword">if</span> (!source) <span class="keyword">return</span> draft</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> <span class="title function_">source</span>(draft, action)</span><br><span class="line">    draft.<span class="property">actionStatus</span>[actionType] = status === <span class="variable constant_">FAILURE</span> ? error : status</span><br><span class="line">    source[status] &amp;&amp; source[status](draft, action)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="title function_">combineReducers</span>(&#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="title function_">reduceFunc</span>(userReducerMap, userInitialState),</span><br><span class="line">  <span class="attr">post</span>: <span class="title function_">reduceFunc</span>(postReducerMap, postInitialState),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer</span><br></pre></td></tr></table></figure>

<h2 id="4-useRedux-hook"><a href="#4-useRedux-hook" class="headerlink" title="4. useRedux hook"></a>4. useRedux hook</h2><p>컴포넌트 쪽은 간단하게 소개해 보겠습니다. 우선적으로 react만으로 작성한 컴포넌트에서 redux store로의 접근을 보다 편리하게 하고자 useRedux 훅을 제작했습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useRedux</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatcher = <span class="title function_">useDispatch</span>()</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">select</span> = (<span class="params">...keys</span>) =&gt; </span><br><span class="line">    <span class="title function_">useSelector</span>(<span class="function"><span class="params">state</span> =&gt;</span> keys.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, k</span>) =&gt;</span> a[k] || a, state))</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">dispatch</span> = (<span class="params">type, data</span>) =&gt; <span class="title function_">dispatcher</span>(&#123; type, data &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    select,</span><br><span class="line">    dispatch,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useRedux</span><br></pre></td></tr></table></figure>

<p>select는 파라미터로 여러개의 문자열을 넘기면, 이로부터 redux store의 해당 키값에 해당하는 프로퍼티를 반환합니다. 다만 문자열에 해당하는 프로퍼티가 없는 경우에는 그대로 이어서 상위 프로퍼티로부터 다음 키를 조회하게 되므로, 예상과 다른 depth에 속한 프로퍼티가 반환되거나, 혹은 실패하기 이전 마지막 프로퍼티가 반환될 가능성이 있습니다. 이 부분만 주의하면 그 외의 문제점은 없는 것 같습니다. <strike>오타는 논외로 하고요</strike> 사용법은 다음과 같습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useRedux <span class="keyword">from</span> <span class="string">&#x27;/hooks/useRedux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;/actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ChangeNickname</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; select, dispatch &#125; = <span class="title function_">useRedux</span>()</span><br><span class="line">  <span class="keyword">const</span> &#123; loggedId &#125; = <span class="title function_">select</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> &#123; nickname &#125; = <span class="title function_">select</span>(<span class="string">&#x27;user&#x27;</span>, loggedId)</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSubmit</span> = e =&gt; <span class="title function_">dispatch</span>(<span class="title class_">Actions</span>.<span class="property">CHANGE_NICKNAME</span>, e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">defaultValue</span>=<span class="string">&#123;nickname&#125;</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit&#125;</span> /&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Comment</span></span><br></pre></td></tr></table></figure>

<h2 id="5-최종-코드"><a href="#5-최종-코드" class="headerlink" title="5. 최종 코드"></a>5. 최종 코드</h2><p>마무리로 전체 구조를 정리해 보겠습니다.</p>
<h3 id="actions-js"><a href="#actions-js" class="headerlink" title="actions.js"></a>actions.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userActions = [</span><br><span class="line">  <span class="string">&#x27;LOGIN&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;LOGOUT&#x27;</span>,</span><br><span class="line">  <span class="comment">// 생략</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> postActions = [</span><br><span class="line">  <span class="comment">// 생략</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  ...userActions,</span><br><span class="line">  ...postActions</span><br><span class="line">].<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, c</span>) =&gt;</span> &#123;</span><br><span class="line">  a[c] = c</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="saga-user-js"><a href="#saga-user-js" class="headerlink" title="saga/user.js"></a>saga/user.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">function</span>*(action) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/login&#x27;</span>, action.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> checkConnection = <span class="keyword">function</span>*() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/connection&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 생략</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN</span>, login],</span><br><span class="line">  <span class="comment">// 생략</span></span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">CONNECTED</span>, checkConnection, throttle, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="saga-index-js"><a href="#saga-index-js" class="headerlink" title="saga/index.js"></a>saga/index.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span></span><br><span class="line"><span class="keyword">import</span> postSaga <span class="keyword">from</span> <span class="string">&#x27;./post&#x27;</span></span><br><span class="line"><span class="keyword">import</span> userSaga <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">taker</span> = (<span class="params">actionType, func, takeMethod = takeLatest, takeOption</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> params = [</span><br><span class="line">    actionType,</span><br><span class="line">    <span class="keyword">function</span>* (action) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">yield</span> <span class="title function_">func</span>(action)</span><br><span class="line">        <span class="keyword">if</span> (!result || !result.<span class="property">data</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;no data&#x27;</span>, actionType)</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;actionType&#125;</span>__success`</span>,</span><br><span class="line">          <span class="attr">data</span>: result.<span class="property">data</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">`<span class="subst">$&#123;actionType&#125;</span>__failure`</span>,</span><br><span class="line">          <span class="attr">error</span>: err.<span class="property">response</span>.<span class="property">data</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">  <span class="keyword">if</span> (takeOption) params.<span class="title function_">unshift</span>(takeOption)</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">method</span>(...params)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">takesAll</span> = sagaItems =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">all</span>(sagaItems.<span class="title function_">map</span>(<span class="function"><span class="params">saga</span> =&gt;</span> <span class="title function_">taker</span>(...saga)))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* <span class="title function_">rootSaga</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">takesAll</span>(postSaga),</span><br><span class="line">    <span class="title function_">takesAll</span>(userSaga),</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="reducer-user-js"><a href="#reducer-user-js" class="headerlink" title="reducer/user.js"></a>reducer/user.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">loggedId</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">actionStatus</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  [<span class="title class_">Actions</span>.<span class="property">LOGIN</span>]: &#123;</span><br><span class="line">    [<span class="variable constant_">SUCCESS</span>]: <span class="function">(<span class="params">draft, &#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">loggedId</span> = data.<span class="property">id</span></span><br><span class="line">      draft[data.<span class="property">id</span>] = data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="reducer-index-js"><a href="#reducer-index-js" class="headerlink" title="reducer/index.js"></a>reducer/index.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">&#x27;immer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> userReducerMap, &#123; initialState <span class="keyword">as</span> userInitialState &#125; <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> postReducerMap, &#123; initialState <span class="keyword">as</span> postInitialState &#125; <span class="keyword">from</span> <span class="string">&#x27;./post&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reduceFunc</span> = (<span class="params">reducerMap, initialState</span>) =&gt; </span><br><span class="line">  <span class="title function_">produce</span>(<span class="function">(<span class="params">draft = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; error, type &#125; = action</span><br><span class="line">    <span class="keyword">const</span> [actionType, status = <span class="variable constant_">REQUEST</span>] = type.<span class="title function_">split</span>(<span class="string">&#x27;__&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> source = reducerMap[actionType]</span><br><span class="line">    <span class="keyword">if</span> (!source) <span class="keyword">return</span> draft</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> <span class="title function_">source</span>(draft, action)</span><br><span class="line">    draft.<span class="property">actionStatus</span>[actionType] = status === <span class="variable constant_">FAILURE</span> ? error : status</span><br><span class="line">    source[status] &amp;&amp; source[status](draft, action)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="title function_">combineReducers</span>(&#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="title function_">reduceFunc</span>(userReducerMap, userInitialState),</span><br><span class="line">  <span class="attr">post</span>: <span class="title function_">reduceFunc</span>(postReducerMap, postInitialState),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer</span><br></pre></td></tr></table></figure>

<h3 id="hook-useRedux-js"><a href="#hook-useRedux-js" class="headerlink" title="hook/useRedux.js"></a>hook/useRedux.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useRedux</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatcher = <span class="title function_">useDispatch</span>()</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">select</span> = (<span class="params">...keys</span>) =&gt; </span><br><span class="line">    <span class="title function_">useSelector</span>(<span class="function"><span class="params">state</span> =&gt;</span> keys.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, k</span>) =&gt;</span> a[k] || a, state))</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">dispatch</span> = (<span class="params">type, data</span>) =&gt; <span class="title function_">dispatcher</span>(&#123; type, data &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    select,</span><br><span class="line">    dispatch,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useRedux</span><br></pre></td></tr></table></figure>

<h3 id="components-Comment-js"><a href="#components-Comment-js" class="headerlink" title="components/Comment.js"></a>components/Comment.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useRedux <span class="keyword">from</span> <span class="string">&#x27;/hooks/useRedux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Actions</span> <span class="keyword">from</span> <span class="string">&#x27;/actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ChangeNickname</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; select, dispatch &#125; = <span class="title function_">useRedux</span>()</span><br><span class="line">  <span class="keyword">const</span> &#123; loggedId &#125; = <span class="title function_">select</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> &#123; nickname &#125; = <span class="title function_">select</span>(<span class="string">&#x27;user&#x27;</span>, loggedId)</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSubmit</span> = e =&gt; <span class="title function_">dispatch</span>(<span class="title class_">Actions</span>.<span class="property">CHANGE_NICKNAME</span>, e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">defaultValue</span>=<span class="string">&#123;nickname&#125;</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit&#125;</span> /&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Comment</span></span><br></pre></td></tr></table></figure>

<h2 id="6-마치며"><a href="#6-마치며" class="headerlink" title="6. 마치며"></a>6. 마치며</h2><p>코드만 잔뜩이고 글은 거의 없는 긴 글(?) 읽으시느라 수고하셨습니다. 실로 오랜만에 즐거운 코딩을 마치고 흥분된 마음으로 소개해 보았습니다. 이미 한물 간 식상한 방식일 수도 있고, 혹은 더 좋은 방법이 있을지도 모르겠네요. 한동안 코드개선방법(?)이나 최신 트랜드 등에 많이 둔감해진 상태이다보니… 만약 그렇더라도 즐거웠으니 그만이긴 하지만, 혹시라도 더 나은 방안을 알고 계시다면, 혹은 그 어떤 것이든 의견이나 정보 공유해 주시면 정말 좋겠네요.</p>
<p>피드백 미리 감사합니다!</p>
</div><div class="article__tags"><a class="article__tags__item" href="/tags/react-js/">React.js</a><a class="article__tags__item" href="/tags/redux-saga/">redux-saga</a><a class="article__tags__item" href="/tags/refactoring/">refactoring</a></div><div class="article__author" itemscope itemprop="author" itemtype="https://schema.org/Person"><img class="article__author__image" src="https://www.gravatar.com/avatar/02e9f56a3202da2e6e0e36a5a23facbb" alt="Jaenam Jung"><a class="article__author__link" title="About Jaenam Jung" rel="author">Jaenam Jung</a><p class="article__author__desc">할 수 있는걸 합니다.</p><div class="article__author__socials"><a class="article__author__socials__item" href="http://github.com/roy-jung" title="github" target="_blank"><i class="fa fa-github"></i></a><a class="article__author__socials__item" href="/atom.xml" title="rss" target="_blank"><i class="fa fa-rss"></i></a></div><meta itemprop="name" content="Jaenam Jung"></div><div class="sharer" id="sharer"><div class="sharer-inner"><div class="sharer__right"><button class="sharer__item" id="sharer-facebook"><i class="fa fa-facebook-official"></i></button><button class="sharer__item" id="sharer-twitter"><i class="fa fa-twitter"></i></button><button class="sharer__item" id="sharer-pinterest"><i class="fa fa-pinterest"></i></button><button class="sharer__item" id="sharer-pocket"><i class="fa fa-get-pocket"></i></button></div></div></div><!-- Disqus Code--><!-- Giscus Code--><script src="https://giscus.app/client.js" data-repo="roy-jung/roy-jung.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzMDcyNDQyMDk=" data-category="General" data-category-id="DIC_kwDOElAssc4Cs9i2" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light_protanopia" data-lang="ko" data-loading="lazy" crossorigin="anonymous" async></script><!-- Meta Tags for Structured Data--><meta itemprop="dateModified" content="2025-04-02T11:37:01.499Z"><meta itemprop="articleBody" content="React.js에 redux 및 redux-saga를 얹어 사용하면서 느낀 피로감을 최소화하고자 노력한 결과가 제 나름으론 만족스럽게 나와 공유하고자 합니다.
패키지 구조redux-saga를 보다 쉽게 사용하고자 하는 데에 포커스를 맞춘 연습용 프로젝트로, 디펜던시는 다음과 같습니다.
123456789&amp;#123;  &amp;quot;react&amp;quot;:..."><meta itemprop="url" content="http://roy-jung.github.io/201111-concise-redux-saga/"><meta itemprop="mainEntityOfPage" content="http://roy-jung.github.io/201111-concise-redux-saga/"><div itemscope itemtype="https://schema.org/Organization" itemprop="publisher"><meta itemprop="name" content="FE재남"><div itemscope itemprop="logo" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="http://roy-jung.github.io/images/logo.png"></div></div><div itemscope itemtype="https://schema.org/ImageObject" itemprop="image"><meta itemprop="contentUrl" content="http://roy-jung.github.io/images/post-cover4.jpg"><meta itemprop="url" content="http://roy-jung.github.io/images/post-cover4.jpg"><meta itemprop="width"><meta itemprop="height"></div></article><section class="related-posts"><h3>Related posts</h3><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/201129_apollo-graphql-infinite-scroll/"><div class="related-posts__item__background" style="background-image:url('/201129_apollo-graphql-infinite-scroll/0.png');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">infinite scroll 구현하기 (1) apollo-graphql</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/201130_swr-graphql-infinite-scroll/"><div class="related-posts__item__background" style="background-image:url('/201130_swr-graphql-infinite-scroll/0.png');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">infinite scroll 구현하기 (2) swr-graphql</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/250414-react-reconciliation-deep-dive/"><div class="related-posts__item__background" style="background-image:url('/images/React Reconciliation Engine.webp');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">React Reconciliation: 컴포넌트 뒤에 숨겨진 엔진 (번역)</span></a></div></section></div></div></div><footer id="footer"><div class="widgets"><div class="widgets-inner"><!-- Jade doesn't support dynamic inclusion with `each`.--><!-- So, I just hard coded the file names that will be included.--><div class="widgets__item"><h3 class="widgets__item__heading">Recent posts</h3><ul class="recent-posts"><li class="recent-posts__item"><a href="/250826-tc39-plenary/">2025년 5월 TC39 총회 요약 (번역)</a></li><li class="recent-posts__item"><a href="/250701-history-of-js/">간략한 자바스크립트 역사 (번역)</a></li><li class="recent-posts__item"><a href="/iterator-helper-overview/">이터레이터 헬퍼 맛보기</a></li><li class="recent-posts__item"><a href="/250414-react-reconciliation-deep-dive/">React Reconciliation: 컴포넌트 뒤에 숨겨진 엔진 (번역)</a></li><li class="recent-posts__item"><a href="/250323-react-server-components/">리액트 서버 컴포넌트 톺아보기 (번역)</a></li></ul></div><div class="widgets__item"><h3 class="widgets__item__heading">Archives</h3><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">2025 8월</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">2025 7월</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">2025 5월</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">2025 4월</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">2022 1월</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">2020 11월</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">2020 10월</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">2017 1월</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">2016 12월</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">2016 11월</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">2016 10월</a><span class="archive-list-count">2</span></li></ul></div><div class="widgets__item"><h3 class="widgets__item__heading">Categories</h3><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ecmascript/">ECMAScript</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fe/">FE</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/fe/react-js/">React.js</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/fe/react-js/next-js/">Next.js</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/fe/javascript/">javascript</a><span class="category-list-count">6</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">2</span></li></ul></div></div></div><p class="copyright"><small>© 2025 Jaenam Jung<br>Powered by <a href="https://hexo.io" rel="external" target="_blank">Hexo</a>, Theme by <a href="https://github.com/hyunseob" rel="external" target="_blank">HyunSeob</a></small></p></footer><script src="/js/sharer.min.js"></script></body></html>